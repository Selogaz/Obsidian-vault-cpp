---
tags:
  - note/basic/primary
  - category/linux
aliases: []
created: 2026-02-28T18:00:00+03:00
updated: 2026-02-28T22:54:39+03:00
---

# How Linux Works — Конспект

> **Источник:** [[How Linux Works|Brian Ward, How Linux Works, 3rd Edition (2016/2021)]]

---

## Глава 1: Общая картина (The Big Picture)

### 1.1 Уровни и слои абстракции в Linux

Абстракция — способ игнорирования деталей для упрощения работы.

**Три главных уровня ОС Linux:**

1. **Аппаратные средства** — CPU, RAM, диски, сетевые интерфейсы
2. **Ядро** (kernel) — программа в памяти, управляющая硬件
	 - Работает в **режиме ядра** (kernel mode)
	 - Обладает неограниченным доступом к CPU и RAM
	 - Область только для ядра — **пространство ядра** (kernel space)
3. **Процессы** — запущенные программы
	 - Работают в **режиме пользователя** (user mode)
	 - Область — **пространство пользователя** (user space)
	 - При ошибке ядро может очистить последствия

> [!note] → **Отдельная заметка:** [[уровни абстракции в linux]]

---

### 1.2 Аппаратные средства: RAM

- Ядро и процессы — **наборы битов** в оперативной памяти
- CPU считывает инструкции и данные из RAM, записывает результаты обратно
- **Состояние** — упорядоченное расположение битов
- **Образ** (image) — абстрактное представление размещения битов

> [!note] → **Отдельная заметка:** [[оперативная память в linux]]

---

### 1.3 Ядро Linux

Ядро решает four основные задачи:

1. **Управление процессами** — распределение времени CPU между процессами
2. **Управление памятью** — отслеживание состояния всей RAM
3. **Драйверы устройств** — интерфейс между硬件 и процессами
4. **Системные вызовы** (syscalls) — API для взаимодействия процессов с ядром

> [!note] → **Отдельная заметка:** [[архитектура ядра linux]]

---

### 1.4 Пользовательское пространство (User Space)

Процессы, запущенные в пользовательском режиме:
- GUI (графические оболочки)
- Серверы
- Командные оболочки (shell)

> [!note] → **Отдельная заметка:** [[пользовательское пространство linux]]

---

### 1.5 Пользователи

- Ядро не понимает "пользователей" — это абстракция пространства пользователя
- Пользователи нужны для: разрешений, аудита, изоляции

> [!note] → **Отдельная заметка:** [[модель пользователей в linux]]

---

### 1.6 Семейства дистрибутивов

- **Debian-семья:** Debian, Ubuntu
- **RHEL-семья:** RHEL, Fedora, CentOS
- **Встроенные системы:** Android, OpenWRT

> [!note] → **Отдельная заметка:** [[семейства дистрибутивов linux]]

---

## Глава 2: Основные команды и структура каталогов

### 2.1 Bourne Shell (/bin/sh)

- Стандартная командная оболочка
- Основа для bash, zsh и других

> [!note] → **Отдельная заметка:** [[bourne shell]]

---

### 2.2 Стандартные потоки

- **stdin** (0) — стандартный ввод
- **stdout** (1) — стандартный вывод
- **stderr** (2) — стандартный вывод ошибок

Перенаправление: `>`, `>>`, `<`, `|`, `2>`

> [!note] → **Отдельная заметка:** [[stdin stdout stderr]]

---

### 2.3 Базовые команды

| Команда | Назначение |
|---------|------------|
| `ls` | Список файлов |
| `cd` | Смена директории |
| `pwd` | Текущая директория |
| `cp` | Копирование |
| `mv` | Перемещение |
| `rm` | Удаление |
| `cat` | Вывод содержимого |
| `mkdir` | Создание директории |
| `touch` | Создание пустого файла |

> [!note] → **Отдельная заметка:** [[основные команды linux]]

---

### 2.4 Права доступа

- **r** (read) — чтение
- **w** (write) — запись
- **x** (execute) — выполнение

Категории: **u** (user/owner), **g** (group), **o** (others), **a** (all)

Команды: `chmod`, `chown`, `chgrp`

> [!note] → **Отдельная заметка:** [[права доступа к файлам linux]]

---

### 2.5 Архивирование и сжатие

- `gzip` — сжатие (.gz)
- `tar` — архивирование (.tar)
- `tar + gzip` — .tar.gz или .tgz
- `zip` — сжатие (.zip)

> [!note] → **Отдельная заметка:** [[команды архивирования linux]]

---

### 2.6 Иерархия директорий (FHS)

| Путь | Содержимое |
|------|------------|
| `/` | Корень |
| `/bin` | Основные программы |
| `/sbin` | Системные программы |
| `/etc` | Конфигурация |
| `/home` | Домашние директории |
| `/root` | Домашняя директория root |
| `/usr` | Пользовательские программы |
| `/var` | Изменяемые данные (логи, кеши) |
| `/tmp` | Временные файлы |
| `/proc` | Файловая система процессов |
| `/sys` | Файловая система sysfs |
| `/dev` | Файлы устройств |
| `/boot` | Загрузочные файлы |
| `/lib` | Системные библиотеки |
| `/opt` | Дополнительное ПО |
| `/mnt` | Точки монтирования |
| `/media` | Сменные носители |

> [!note] → **Отдельная заметка:** [[иерархия директорий linux]]

---

### 2.7 Работа от root

- `sudo` — выполнение от имени другого пользователя
- `su` — смена пользователя
- `sudo -i` — интерактивная оболочка root

> [!note] → **Отдельная заметка:** [[выполнение команд от root]]

---

## Глава 3: Устройства

### 3.1 Файлы устройств (/dev)

- **Символьные устройства** — побайтовая передача (терминалы, последовательные порты)
- **Блочные устройства** — блочная передача (диски)

### 3.2 Именование устройств

| Устройство | Путь |
|------------|------|
| Жёсткие диски | `/dev/sd*` (sda, sdb…) |
| Разделы | `/dev/sda1`, `/dev/sda2` |
| Терминалы | `/dev/tty*` |
| Последовательные порты | `/dev/ttyUSB*` |
| Звуковые устройства | `/dev/snd/*` |
| Петли (loop) | `/dev/loop*` |
| Null | `/dev/null` |
| Zero | `/dev/zero` |
| Random | `/dev/random`, `/dev/urandom` |

### 3.3 Команда dd

```bash
dd if=/dev/zero of=/dev/sdb bs=1M count=100  # Запись нулей
dd if=input.iso of=/dev/cdrom  # Запись ISO
```

### 3.4 Udev — динамическое создание устройств

- Создаёт файлы устройств в `/dev` на основе информации из `/sys`
- Правила в `/etc/udev/rules.d/`

> [!note] → **Отдельная заметка:** [[файлы устройств linux]]
> [!note] → **Отдельная заметка:** [[udev и именование устройств]]

---

## Глава 4: Диски и файловые системы

### 4.1 Разметка дисков (Partitioning)

- **MBR** — старый формат, до 2TB, 4 первичных раздела
- **GPT** — новый формат, до 8ZB, неограниченное количество разделов

Инструменты: `fdisk`, `parted`, `gdisk`

### 4.2 Типы файловых систем

| ФС | Особенности |
|----|-------------|
| **ext4** | Стандартная, журналирование, обратная совместимость |
| **xfs** | Высокая производительность, большие файлы |
| **btrfs** | CoW, снимки, RAID встроенный |
| **swap** | Файл подкачки |
| **vfat** | Совместимость с Windows |
| **ntfs** | Windows NTFS (через драйвер) |
| **iso9660** | CD/DVD |

### 4.3 Журналирование

Журнал записывает изменения до фактического выполнения — защита от сбоев.

### 4.4 Монтирование

```bash
mount /dev/sda1 /mnt/data    # Монтирование
umount /mnt/data             # Размонтирование
mount                        # Показать текущие монтирования
df -h                        # Использование дисков
```

### 4.5 LVM (Logical Volume Manager)

- **PV** (Physical Volume) — физический диск
- **VG** (Volume Group) — группа томов
- **LV** (Logical Volume) — логический том

```bash
pvcreate /dev/sdb1
vgcreate vg0 /dev/sdb1
lvcreate -n data -L 10G vg0
```

> [!note] → **Отдельная заметка:** [[файловые системы linux]]
> [!note] → **Отдельная заметка:** [[разметка дисков linux]]
> [!note] → **Отдельная заметка:** [[lvm linux]]

---

## Глава 5: Загрузка ядра Linux

### 5.1 Загрузчики

1. **BIOS/UEFI** — проверка оборудования, передаёт управление загрузчику
2. **Загрузчик** (GRUB, syslinux) — загружает ядро в память
3. **Ядро** — инициализирует оборудование, запускает init

### 5.2 Параметры загрузки ядра

Передаются через GRUB: `kernel /vmlinuz root=/dev/sda1 ro quiet`

### 5.3 Init — начало пространства пользователя

Первый процесс (PID 1): `/sbin/init` (или systemd)

> [!note] → **Отдельная заметка:** [[процесс загрузки linux]]
> [!note] → **Отдельная заметка:** [[загрузчики linux]]

---

## Глава 6: Запуск пространства пользователя

### 6.1 Systemd

- Современная система инициализации
- Первый процесс (PID 1)
- Управляет сервисами, mount points, таймерами

### 6.2 Юниты (Units)

| Тип | Описание | Файл |
|-----|----------|------|
| **service** | Сервис/демон | `.service` |
| **socket** | Сокет | `.socket` |
| **target** | Группа юнитов (аналог runlevel) | `.target` |
| **mount** | Точка монтирования | `.mount` |
| **timer** | Таймер | `.timer` |
| **path** | Путь (отслеживание) | `.path` |

### 6.3 Targets (уровни запуска)

| Target | Описание |
|--------|----------|
| `multi-user.target` | Многопользовательский режим (текстовый) |
| `graphical.target` | Графический режим |
| `rescue.target` | Режим восстановления |
| `emergency.target` | Экстренный режим |
| `shutdown.target` | Остановка системы |

### 6.4 Управление сервисами

```bash
systemctl start nginx          # Запуск
systemctl stop nginx           # Остановка
systemctl restart nginx        # Перезапуск
systemctl status nginx         # Статус
systemctl enable nginx         # Автозапуск
systemctl disable nginx        # Отключить автозапуск
systemctl list-units --type=service  # Список сервисов
systemctl list-dependencies graphical.target  # Зависимости
```

> [!note] → **Отдельная заметка:** [[systemd]]
> [!note] → **Отдельная заметка:** [[systemd units]]
> [!note] → **Отдельная заметка:** [[управление сервисами linux]]

---

## Глава 7: Конфигурация системы

### 7.1 Системное логирование

- **syslog** — классический демон логирования
- **rsyslog** — расширенный syslog
- **journald** — systemd journal (бинарные логи)

```bash
journalctl -u nginx            # Логи сервиса
journalctl -xe                 # Все логи с конца
/var/log/syslog                # Системные логи
/var/log/messages              # Общие сообщения
/var/log/auth.log              # Аутентификация
```

### 7.2 Системное время

```bash
timedatectl status             # Статус времени
timedatectl set-timezone Europe/Moscow
timedatectl set-time 09:00:00
```

NTP синхронизация: `systemctl enable chronyd`

### 7.3 Планирование задач

**cron** — периодические задачи
```bash
crontab -e                     # Редактировать crontab
crontab -l                     # Просмотр crontab
```

Формат: `минута час день месяц день_недели команда`

**at** — одноразовые задачи
```bash
at 14:30 tomorrow
at> /path/to/script.sh
Ctrl+D
```

### 7.4 Управление пользователями

```bash
useradd -m username            # Создать пользователя
usermod -aG group user         # Добавить в группу
userdel -r username            # Удалить
passwd username                # Изменить пароль
```

Файлы:
- `/etc/passwd` — учётные записи
- `/etc/shadow` — пароли (зашифрованные)
- `/etc/group` — группы

> [!note] → **Отдельная заметка:** [[системное логирование linux]]
> [!note] → **Отдельная заметка:** [[планирование задач cron]]
> [!note] → **Отдельная заметка:** [[управление пользователями linux]]

---

## Глава 8: Процессы и использование ресурсов

### 8.1 Ресурсы процесса

- **CPU** — время процессора
- **Memory** — оперативная память
- **I/O** — ввод/вывод (диск, сеть)

### 8.2 Мониторинг процессов

```bash
ps aux                         # Все процессы
ps -ef                         # Полный формат
top                            # Интерактивный монитор
htop                           # Улучшенный top
pstree                         # Древовидное представление
```

### 8.3 Приоритеты процессов

- **nice** — приоритет от -20 (высший) до 19 (низший)
- **renice** — изменить приоритет работающего процесса

```bash
nice -n 10 ./script.sh         # Запуск с приоритетом
renice -n -5 $(pid)            # Изменить приоритет
```

### 8.4 Файловая система /proc

Виртуальная файловая система с информацией о ядре и процессах:

| Путь | Содержимое |
|------|------------|
| `/proc/cpuinfo` | Информация о CPU |
| `/proc/meminfo` | Информация о памяти |
| `/proc/uptime` | Время работы системы |
| `/proc/[pid]/` | Информация о процессе |
| `/proc/1/` | Информация об init |
| `/proc/sys/` | Параметры ядра |

```bash
cat /proc/cpuinfo
cat /proc/meminfo
ls /proc/1/
```

> [!note] → **Отдельная заметка:** [[мониторинг процессов linux]]
> [!note] → **Отдельная заметка:** [[файловая система proc]]
> [!note] → **Отдельная заметка:** [[приоритеты процессов linux]]

---

## Глава 9: Сеть и её конфигурация

### 9.1 Сетевые интерфейсы

```bash
ip link show                   # Список интерфейсов
ip addr show                  # IP-адреса
ip route show                 # Таблица маршрутизации
ifconfig                      # Старый способ (устарел)
```

### 9.2 IP-адреса

```bash
ip addr add 192.168.1.10/24 dev eth0
ip addr del 192.168.1.10/24 dev eth0
```

IPv4 vs IPv6

### 9.3 DNS

- `/etc/resolv.conf` — DNS-серверы
- `/etc/hosts` — статические записи

```bash
nameserver 8.8.8.8
nameserver 8.8.4.4
```

### 9.4 Маршрутизация

```bash
ip route add default via 192.168.1.1
ip route add 10.0.0.0/8 via 192.168.1.254
route -n                      # Таблица маршрутов
```

### 9.5 NetworkManager

Управляет сетевыми подключениями (WiFi, Ethernet)

```bash
nmcli device wifi list        # WiFi сети
nmcli connection up id "My WiFi"
nmtui                         # Текстовый интерфейс
```

> [!note] → **Отдельная заметка:** [[сетевые интерфейсы linux]]
> [!note] → **Отдельная заметка:** [[ip адресация linux]]
> [!note] → **Отдельная заметка:** [[dns в linux]]
> [!note] → **Отдельная заметка:** [[маршрутизация linux]]

---

## Глава 10: Сетевые приложения и службы

### 10.1 Сетевые серверы

- **SSH** (port 22) — удалённый доступ
- **HTTP/HTTPS** (80/443) — веб-серверы
- **FTP** (20/21) — передача файлов
- **SMTP** (25) — отправка почты
- **DNS** (53) — разрешение имён

### 10.2 Ports и Services

- `/etc/services` — соответствие портов сервисам
- Well-known ports: 0-1023
- Registered ports: 1024-49151
- Dynamic ports: 49152-65535

### 10.3 Netstat и ss

```bash
ss -tuln                      # Просмотр открытых портов
netstat -tuln                 # Устаревший аналог
lsof -i :80                   # Процессы на порту 80
```

> [!note] → **Отдельная заметка:** [[сетевые порты linux]]

---

## Глава 11: Введение в сценарии оболочки

### 11.1 Основы

```bash
#!/bin/bash
echo "Hello, World!"
```

### 11.2 Переменные

```bash
name="Value"
echo $name
echo ${name}
```

### 11.3 Параметры

- `$0` — имя скрипта
- `$1, $2...` — позиционные параметры
- `$#` — количество параметров
- `$@` — все параметры
- `$?` — код возврата последней команды

### 11.4 Условные конструкции

```bash
if [ $name = "value" ]; then
    echo "yes"
elif [ $name = "other" ]; then
    echo "other"
else
    echo "no"
fi
```

### 11.5 Циклы

```bash
for i in {1..5}; do
    echo $i
done

while true; do
    echo "loop"
done
```

### 11.6 Функции

```bash
function hello() {
    echo "Hello, $1!"
}
hello "World"
```

> [!note] → **Отдельная заметка:** [[основы shell скриптов]]
> [!note] → **Отдельная заметка:** [[переменные в shell]]

---

## Глава 12: Передача файлов по сети

### 12.1 Rsync

```bash
rsync -avz source/ dest/              # Синхронизация
rsync -avz --delete source/ dest/     # С удалением
rsync -e ssh user@host:/path ./       # Через SSH
```

### 12.2 Scp и sftp

```bash
scp file.txt user@host:/path/         # Копирование
scp user@host:/path/file.txt ./       # Скачивание
sftp user@host                        # Интерактивный
```

### 12.3 NFS

Сетевая файловая система Unix:

```bash
# Сервер
/etc/exports:
/share 192.168.1.0/24(rw,sync)

exportfs -a
systemctl start nfs-server

# Клиент
mount -t nfs server:/share /mnt/nfs
```

### 12.4 Samba (SMB/CIFS)

Совместный доступ с Windows:

```bash
# Сервер
/etc/samba/smb.conf

systemctl start smb

# Клиент
mount -t cifs //server/share /mnt -o user=guest
smbclient //server/share -U user
```

> [!note] → **Отдельная заметка:** [[rsync]]
> [!note] → **Отдельная заметка:** [[nfs]]
> [!note] → **Отдельная заметка:** [[samba]]

---

## Глава 13: Пользовательское окружение

### 13.1 Процесс входа

1. getty — ожидает входа
2. login — запрашивает имя/пароль
3. PAM — аутентификация
4. Shell — запускает оболочку

### 13.2 Переменные окружения

```bash
printenv                      # Все переменные
echo $PATH                    # Конкретная
export VAR=value              # Установить
PATH=$PATH:/new/path          # Добавить к PATH
```

Важные переменные:
- `PATH` — пути для исполняемых файлов
- `HOME` — домашняя директория
- `USER` — имя пользователя
- `SHELL` — текущая оболочка
- `PWD` — текущая директория
- `LANG` — локаль

### 13.3 Настройка shell

Файлы конфигурации:
- `/etc/profile` — системный профиль
- `~/.bash_profile` — персональный (bash, выполняется при login)
- `~/.bashrc` — персональный (каждый запуск bash)
- `~/.bash_history` — история команд

### 13.4 Локализация

```bash
locale                        # Текущие настройки
locale -a                     # Доступные локали
LANG=C.UTF-8                  # Установить локаль
```

> [!note] → **Отдельная заметка:** [[процесс входа в linux]]
> [!note] → **Отдельная заметка:** [[переменные окружения linux]]
> [!note] → **Отдельная заметка:** [[настройка bash]]

---

## Глава 14: Рабочий стол Linux

### 14.1 X Window System (X11)

- Клиент-серверная система графики
- X-сервер — отрисовка
- X-клиент — приложения

### 14.2 Срезы рабочего стола

- **GNOME** — современный, минималистичный
- **KDE** — функциональный, настраиваемый
- **XFCE** — легковесный
- **i3/sway** — тайловые оконные менеджеры

### 14.3 Печать (CUPS)

```bash
lpstat -t                     # Статус принтеров
lpq                           # Очередь печати
lpr file.txt                  # Печать
lpadmin                       # Настройка принтера
```

> [!note] → **Отдельная заметка:** [[x window system]]

---

## Глава 15: Контейнеры

### 15.1 Основы контейнеризации

- Изоляция процессов на уровне ядра
- Namespace — изоляция ресурсов
- Cgroup — контроль ресурсов

### 15.2 Docker

```bash
docker run -it ubuntu bash    # Запустить контейнер
docker ps                     # Работающие контейнеры
docker ps -a                  # Все контейнеры
docker images                 # Образы
docker build -t myapp .       # Сборка образа
docker stop container_id      # Остановка
docker rm container_id       # Удаление
```

### 15.3 Dockerfile

```dockerfile
FROM ubuntu:20.04
WORKDIR /app
COPY . .
RUN apt-get update && apt-get install -y nginx
CMD ["nginx", "-g", "daemon off;"]
EXPOSE 80
```

### 15.4 Docker Compose

```yaml
version: '3'
services:
  web:
    build: .
    ports:
      - "80:80"
  db:
    image: postgres
```

> [!note] → **Отдельная заметка:** [[docker основы]]
> [!note] → **Отдельная заметка:** [[dockerfile]]

---

## Глава 16: Компиляция ПО из исходного кода

### 16.1 Компиляторы

- **gcc** — GNU Compiler Collection
- **clang** — LLVM компилятор

```bash
gcc -o program program.c       # Компиляция
gcc -O2 -Wall -o program program.c  # Оптимизация + предупреждения
```

### 16.2 Make и Makefiles

```makefile
CC = gcc
CFLAGS = -Wall -O2
TARGET = program

all: $(TARGET)

$(TARGET): main.o utils.o
    $(CC) -o $@ $^ $(CFLAGS)

%.o: %.c
    $(CC) -c -o $@ $< $(CFLAGS)

clean:
    rm -f $(TARGET) *.o
```

### 16.3 Библиотеки

- **Статические** (.a) — включаются в исполняемый файл
- **Динамические** (.so) — загружаются при запуске

```bash
ldd program                   # Зависимости от библиотек
ldconfig                      # Обновить кэш библиотек
/etc/ld.so.conf              # Пути к библиотекам
```

### 16.4 Управление пакетами

- **configure** — скрипт проверки системы
- **cmake** — кроссплатформенный make
- **autotools** — autoconf, automake

> [!note] → **Отдельная заметка:** [[компиляция в linux]]
> [!note] → **Отдельная заметка:** [[make и makefiles]]

---

## Глава 17: Виртуализация

### 17.1 Типы виртуализации

- **Аппаратная** — KVM, Xen, VMware
- **Контейнерная** — Docker, Podman, LXC
- **Паравиртуализация** — модифицированная гостевая ОС

### 17.2 KVM/QEMU

```bash
qemu-system-x86_64 -hda disk.img -m 2048 -cdrom os.iso
virt-install --name vm1 --ram 2048 --disk path=/var/lib/libvirt/images/vm1.img
virsh start vm1
virsh list --all
```

### 17.3 Контейнерная виртуализация

- **Docker** — контейнеры приложений
- **Podman** — docker-совместимый, без демона
- **LXC** — контейнеры на уровне ОС

### 17.4 Kubernetes

Оркестрация контейнеров:
- **Pod** — минимальная единица
- **Deployment** — управление подами
- **Service** — сетевой доступ
- **Ingress** — HTTP маршрутизация

> [!note] → **Отдельная заметка:** [[виртуализация в linux]]
> [!note] → **Отдельная заметка:** [[kvm]]
> [!note] → **Отдельная заметка:** [[kubernetes основы]]

---

# Сводка атомизации

| Глава | Темы для атомизации |
|-------|---------------------|
| 1 | 6 заметок |
| 2 | 5 заметок |
| 3 | 2 заметки |
| 4 | 3 заметки |
| 5 | 2 заметки |
| 6 | 3 заметки |
| 7 | 3 заметки |
| 8 | 3 заметки |
| 9 | 4 заметки |
| 10 | 1 заметка |
| 11 | 2 заметки |
| 12 | 3 заметки |
| 13 | 3 заметки |
| 14 | 1 заметка |
| 15 | 2 заметки |
| 16 | 2 заметки |
| 17 | 3 заметки |

**Всего:** ~50 атомарных заметок

---

*Конспект создан: 2026-02-28*
*Источник: [[How Linux Works]]*
