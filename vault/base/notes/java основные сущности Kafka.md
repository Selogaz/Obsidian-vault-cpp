---
tags:
  - note/specific/code
  - category/java
aliases:
  - основные сущности Kafka
deck: obsidian::java
created: 2025-09-26T13:54:09+03:00
updated: 2025-09-26T13:54:09+03:00
---

**основные сущности Kafka**
—
# Message
Сообщение (Message) - единица полезной информации. Каждое сообщение состоит из ключа, значения (payload), времени добавления и заголовков (headers). Обязательным элементом является только payload.
# Broker
сервер Kafka, который принимает, хранит и распределяет сообщения. В кластере Kafka может быть несколько брокеров

# Topic
категория сообщений в Kafka. Например, топик "orders", "notifications"

Могут быть разделены на партиции: orders-1, orders-2. Партиции помогают распределить нагрузку и масштабировать систему. Сообщения хранятся упорядоченно только в пределах одной партиции.

# Producers
Клиенты, которые публикуют сообщения в топики Kafka. Могут указывать партицию для записи или просто отправлять в топик.

# Consumers
клиенты, которые читают сообщения из топиков Kafka.

Kafka использует pull-модель: потребители сами запрашивают сообщения, когда им удобно их обрабатывать и в том количестве, которое они могут обработать. В других брокерах, например, RabbitMQ используется push модель, когда сообщения отправляются потребителям автоматически.

Потребители объединяются в группы (consumer groups) для распределенной обработки сообщений

# Consumer Group
набор клиентов, которые совместно обрабатывают сообщения из топика.

*Каждая партиция потребляется только одним потребителем* в группе. Каждый потребитель может обрабатывать несколько партиций. Таким образом сообщения распределяются среди участников.

Kafka хранит оффсеты для групп в топике _consumer_offsets.

При добавлении или удалении потребителей происходит ребалансировка - перераспределение партиций между активными потребителями. Благодаря консьюмер группам и ребалансировке система гибко адаптируется к изменениям.

# Репликация

Пример: 3 партиции и 3 консьюмера, каждый обрабатывает по одной.
- Если один консьюмер упадет, его партиции перераспределятся между двумя оставшимися. У одного будет 2 партиции, у другого - 1.
- Если в группу добавится четвертый консьюмер, ему не хватит партиции, и он не будет получать сообщения.

Репликация помогает Кафке масштабироваться и надёжно хранить данные.

Каждая партиция имеет несколько реплик (копий на разных брокерах). Одна реплика называется лидер (leader), остальные - фолловеры (followers). Принцип работы:
- Продюсер отправляет сообщение лидеру партиции
- Лидер сохраняет сообщение у себя и отправляет его фолловерам
- После успешной записи на несколько реплик сообщение считается зафиксированным (commited)

В зависимости от параметров достигаются разные гарантии доставки.
# Дополнительные материалы
[[java Kafka|Kafka]] - заметка про кафку из [[Лучший Гайд по Kafka для Начинающих За 1 Час|видео]] Мишустина
[[Kafka за 20 минут. Ментальная модель и как с ней работать]]
[[Kafka Rebalancing]]
[[Снижение ребалансировок в Kafka при частом мерцании]]
