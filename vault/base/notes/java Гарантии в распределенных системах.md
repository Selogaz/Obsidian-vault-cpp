---
tags:
  - note/specific/code
  - category/java
aliases:
  - Гарантии в распределенных системах
deck: obsidian::java
created: 2025-09-27T18:40:56+03:00
updated: 2025-09-27T18:40:56+03:00
---

**Гарантии в распределенных системах**
—
Определяют, как данные обрабатываются и сохраняются при сбоях, проблемах с сетью или с сервисами. О гарантиях часто говорят в контексте Kafka, но это более широкое понятие и применяется ко многим системам.

Выделяют 2 основные категории:
- Гарантии доставки: at-most-once, at-least-once, exactly-once
- Гарантии сохранения последовательности. Определяют, получит ли получать события в том же порядке в котором их отправил отправитель. Гарантия порядка либо есть, либо нет.

Также есть более частные "договоренности". Для БД: [[java ACID|ACID]] или <font color="#ffff00">BASE</font>, для сетевых протоколов <font color="#ffff00">QoS</font>

## Гарантии доставки

at-most-once гарантирует, что сообщение будет доставлено хотя бы один раз. Плюс - минимум издержек, минус - риск потери данных.

Примеры:
- HTTP: отправка запроса без retry
- Kafka: отправка сообщения в топик без подтверждения о получении
- БД: транзакция

at-least-once гарантирует, что сообщение будет доставлено минимум один раз.

Обычно достигается повторной отправкой, если подтверждение не было получено. Это может привести к дублированию сообщений, если предыдущая отправка на самом деле была успешной, но подтверждение было потеряно из-за сетевой задержки или сбоев.

Плюс - данные не теряются даже при сбоях. Минус - требуется [[java идемпотетность|идемпотетность]] операций или обработка дубликатов на клиенте.

Примеры:
- HTTP: повторная отправка запроса при таймауте или ошибке
- Kafka: отправка сообщения с подтверждением от брокера
- БД: повторный запрос транзакции при сбое

exactly-once гарантирует, что сообщение будет доставлено ровно один раз. Плюс - нет потерь и дублей. Минус - высокие накладные расходы и сложность реализации.

Примеры:
- HTTP: идемпотентные операции с Retry (например, PUT с уникальным ID)
- Kafka: транзакции с идемпотентным продюсером и изоляцией потребителя
- БД: <font color="#ffff00">Компенсирующие транзакции (Saga) </font>или <font color="#ffff00">двухфазный коммит (2PC)</font>

# Дополнительные материалы
[Семантики доставки событий в распределенных системах](“Семантики доставки событий в распределенных системах” ([“Семантики доставки событий в распределенных системах / Хабр”](zotero://select/library/items/K7GLETXB)) ([snapshot](zotero://open-pdf/library/items/K4GKZCA7?sel=h1%20%3E%20span&annotation=UDQNDHNX)))
