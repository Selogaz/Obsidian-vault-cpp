/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ce=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var Fe=Object.getOwnPropertyNames;var We=Object.prototype.hasOwnProperty;var Be=(s,o)=>{for(var f in o)ce(s,f,{get:o[f],enumerable:!0})},Oe=(s,o,f,h)=>{if(o&&typeof o=="object"||typeof o=="function")for(let p of Fe(o))!We.call(s,p)&&p!==f&&ce(s,p,{get:()=>o[p],enumerable:!(h=He(o,p))||h.enumerable});return s};var Ve=s=>Oe(ce({},"__esModule",{value:!0}),s);var ze={};Be(ze,{default:()=>ne,renderCalendar:()=>Me});module.exports=Ve(ze);var P=require("obsidian"),xe={addToToday:!0,customFilePath:"",taskPrefix:"#task/one-off"},ne=class extends P.Plugin{async onload(){this.settings=Object.assign({},xe,await this.loadData()),this.addSettingTab(new pe(this.app,this)),window.renderCalendar=Me,window.calendarPluginSettings=this.settings}async saveSettings(){await this.saveData(this.settings)}onunload(){delete window.renderCalendar}},pe=class extends P.PluginSettingTab{constructor(f,h){super(f,h);this.plugin=h}display(){let{containerEl:f}=this;f.empty(),new P.Setting(f).setName("Add to today's note").setDesc("If enabled, tasks will be added to today's periodic note.").addToggle(h=>h.setValue(this.plugin.settings.addToToday).onChange(async p=>{this.plugin.settings.addToToday=p,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.addToToday||new P.Setting(f).setName("Custom file path").setDesc("If set, tasks will be added to this file instead of the daily note.").addText(h=>h.setPlaceholder("periodic/daily/2024-06-10.md").setValue(this.plugin.settings.customFilePath).onChange(async p=>{this.plugin.settings.customFilePath=p,await this.plugin.saveSettings()})),new P.Setting(f).setName("Task prefix").setDesc("Prefix to add before the task text (e.g. #task/one-off).").addText(h=>h.setPlaceholder("#task/one-off").setValue(this.plugin.settings.taskPrefix).onChange(async p=>{this.plugin.settings.taskPrefix=p,await this.plugin.saveSettings()}))}};function ve(s){return s[0].toUpperCase()+s.slice(1)}function ke(s){let o=s.match(/^(?:.*\/)?([^\/]+?|)(?=(?:\.[^\/.]*)?$)/);return o?o[1]:s}function de(s,o,f){var p;return((p=s.pages(`"${o.link.path}"`)[f])==null?void 0:p[0])||""}function Ue(s){let o=s;return o=o.split(".").join("\\."),o=o.split(",").join("\\,"),o=o.split("-").join("\\-"),o=o.split(":").join("\\:"),o=o.split(" ").join("\\s"),o=o.replace("dddd","\\w{1,}"),o=o.replace("ddd","\\w{1,3}"),o=o.replace("dd","\\w{2}"),o=o.replace("d","\\d{1}"),o=o.replace("YYYY","\\d{4}"),o=o.replace("YY","\\d{2}"),o=o.replace("MMMM","\\w{1,}"),o=o.replace("MMM","\\w{3}"),o=o.replace("MM","\\d{2}"),o=o.replace("DDDD","\\d{3}"),o=o.replace("DDD","\\d{1,3}"),o=o.replace("DD","\\d{2}"),o=o.replace("D","\\d{1,2}"),o=o.replace("ww","\\d{1,2}"),`^(${o})$`}async function Me(s,o){var he;let{pages:f,view:h,firstDayOfWeek:p,globalTaskFilter:C,dailyNoteFolder:I,dailyNoteFormat:b,startPosition:$,upcomingDays:fe,css:Z,options:O}=o,B=window.moment(),V=B.format("YYYY-MM-DD"),K=B.format("M"),Q=B.format("d"),_=B.format("YYYY"),H=new Date().getTime();if(!f&&f!=="")return s.span(`> [!ERROR] Missing pages parameter
> 
> Please set the pages parameter like
> 
> \`pages: ""\``),!1;if(!O||!O.includes("style"))return s.span(`> [!ERROR] Missing style parameter
> 
> Please set a style inside options parameter like
> 
> \`options: "style1"\``),!1;if(!h)return s.span(`> [!ERROR] Missing view parameter
> 
> Please set a default view inside view parameter like
> 
> \`view: "month"\``),!1;if(p){if(!p.match(/[|\\0123456]/g))return s.span(`> [!ERROR] Wrong value inside firstDayOfWeek parameter
> 
> Please choose a number between 0 and 6`),!1}else return s.span(`> [!ERROR] Missing firstDayOfWeek parameter
> 
> Please set the first day of the week inside firstDayOfWeek parameter like
> 
> \`firstDayOfWeek: "1"\``),!1;if($&&!$.match(/\d{4}\-\d{1,2}/gm))return s.span("> [!ERROR] Wrong startPosition format\n> \n> Please set a startPosition with the following format\n> \n> Month: `YYYY-MM` | Week: `YYYY-ww`"),!1;if(b&&((he=b.match(/[|\\YMDWwd.,-: \[\]]/g))==null?void 0:he.length)!==b.length)return s.span("> [!ERROR] The `dailyNoteFormat` contains invalid characters"),!1;let D=[];if(f==="")D=s.pages().file.tasks;else if(typeof f=="string"&&f.startsWith("dv.pages")){let e=f.match(/^dv\.pages\((.*)\)$/);if(e){let d=e[1].trim().replace(/^['\"`](.*)['\"`]$/,"$1");D=s.pages(d).file.tasks}else D=[]}else Array.isArray(f)&&f.every(e=>e.task)?D=f:D=s.pages(f).file.tasks;let ae='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>',se='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>',ee='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>',j='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><path d="M8 14h.01"></path><path d="M12 14h.01"></path><path d="M16 14h.01"></path><path d="M8 18h.01"></path><path d="M12 18h.01"></path><path d="M16 18h.01"></path></svg>',De='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><path d="M17 14h-6"></path><path d="M13 18H7"></path><path d="M7 14h.01"></path><path d="M17 18h.01"></path></svg>',Se='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>',Ge='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5"></path><path d="M16 2v4"></path><path d="M8 2v4"></path><path d="M3 10h5"></path><path d="M17.5 17.5 16 16.25V14"></path><path d="M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z"></path></svg>',Ze='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><path d="m9 16 2 2 4-4"></path></svg>',_e='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h7"></path><path d="M16 2v4"></path><path d="M8 2v4"></path><path d="M3 10h18"></path><path d="M21.29 14.7a2.43 2.43 0 0 0-2.65-.52c-.3.12-.57.3-.8.53l-.34.34-.35-.34a2.43 2.43 0 0 0-2.65-.53c-.3.12-.56.3-.79.53-.95.94-1 2.53.2 3.74L17.5 22l3.6-3.55c1.2-1.21 1.14-2.8.19-3.74Z"></path></svg>',oe="<div class='cell {{class}}' data-weekday='{{weekday}}'><a class='internal-link cellName' href='{{dailyNote}}'>{{cellName}}</a><div class='cellContent'>{{cellContent}}</div></div>",Ce="<div class='task {{class}}' style='{{style}}' title='{{title}}'><div class='inner'><input type='checkbox' class='calendar-task-checkbox' data-task-path='{{filePath}}' data-task-line='{{taskLine}}' {{checked}}><a class='internal-link' href='{{taskPath}}'><div class='note'>{{note}}</div><div class='icon'>{{icon}}</div><div class='description' data-relative='{{relative}}'>{{taskContent}}</div></a></div></div>",Le={done:"\u2705",due:"\u{1F4C5}",scheduled:"\u23F3",recurrence:"\u{1F501}",overdue:"\u26A0\uFE0F",process:"\u23FA\uFE0F",cancelled:"\u{1F6AB}",start:"\u{1F6EB}",dailyNote:"\u{1F4C4}"},i=s.el("div","",{cls:"tasksCalendar "+O,attr:{id:"tasksCalendar"+H,view:h,style:"position:relative;-webkit-user-select:none!important"}});if(Z){let e=document.createElement("style");e.innerHTML=Z,i.append(e)}function Ye(e){for(let n=0;n<e.length;n++){let d=e[n].text,a=ke(e[n].path).match(new RegExp(Ue(b))),l=d.match(/(\d{4}\-\d{2}\-\d{2})/);a&&!l&&(e[n].dailyNote=window.moment(a[1],b).format("YYYY-MM-DD"));let v=d.match(/\📅\s*(\d{4}-\d{2}-\d{2})/);v&&(e[n].due=v[1],e[n].text=e[n].text.replace(v[0],""));let c=d.match(/\🛫\s*(\d{4}-\d{2}-\d{2})/);c&&(e[n].start=c[1],e[n].text=e[n].text.replace(c[0],""));let y=d.match(/\⏳\s*(\d{4}-\d{2}-\d{2})/);y&&(e[n].scheduled=y[1],e[n].text=e[n].text.replace(y[0],""));let S=d.match(/\✅\s*(\d{4}-\d{2}-\d{2})/);S&&(e[n].completion=S[1],e[n].text=e[n].text.replace(S[0],""));let Y=d.match(/\⏰\W(\d{1,2}:\d{2})/);if(Y){let g=Y[1];e[n].text=e[n].text.replace(Y[0],""),e[n].text="\u23F0 "+g+" "+e[n].text}d.includes("\u{1F501}")&&(e[n].recurrence=!0,e[n].text=e[n].text.replace("\u{1F501}","").trim());let w=d.includes("\u{1F53D}");w&&(e[n].priority="D");let t=d.includes("\u{1F53C}");t&&(e[n].priority="B");let r=d.includes("\u23EB");r&&(e[n].priority="A"),!w&&!t&&!r&&(e[n].priority="C"),C?e[n].text=e[n].text.split(C).join(""):e[n].text=e[n].text.replace(/#[\w/-]+/g,""),e[n].text=e[n].text.replace(/\[\[([^|\]]+)\|([^\]]+)\]\]/g,"\u{1F517}$1"),e[n].text=e[n].text.replace(/\[\[([^\]]+)\]\]/g,(g,x)=>"\u{1F517} "+x.replace(/\.[^.]*$/,"")),e[n].text=e[n].text.replace(/\[([^\]]+)\]\([^)]+\)/g,"\u{1F310} $1"),e[n].text=e[n].text.replace(/\[([^\]]*)\]/g,"$1"),/\#task\/regular\b/.test(d)&&(e[n].text="\u{1F501} "+e[n].text)}}function te(e,n){let d=window.moment().format("YYYY-MM-DD"),u=e.filter(t=>t.completed&&t.checked&&t.due&&window.moment(t.due.toString()).isSame(n)).sort((t,r)=>t.due.localeCompare(r.due)),a=e.filter(t=>t.completed&&t.checked&&!t.due&&t.completion&&window.moment(t.completion.toString()).isSame(n)).sort((t,r)=>t.completion.localeCompare(r.completion)),l=e.filter(t=>!t.completed&&!t.checked&&!t.recurrence&&t.due&&window.moment(t.due.toString()).isSame(n)).sort((t,r)=>t.due.localeCompare(r.due)),v=e.filter(t=>!t.completed&&!t.checked&&t.recurrence&&t.due&&window.moment(t.due.toString()).isSame(n)).sort((t,r)=>t.due.localeCompare(r.due)),c=e.filter(t=>!t.completed&&!t.checked&&t.due&&window.moment(t.due.toString()).isBefore(d)).sort((t,r)=>t.due.localeCompare(r.due)),y=e.filter(t=>!t.completed&&!t.checked&&t.start&&window.moment(t.start.toString()).isSame(n)).sort((t,r)=>t.start.localeCompare(r.start)),S=e.filter(t=>!t.completed&&!t.checked&&t.scheduled&&window.moment(t.scheduled.toString()).isSame(n)).sort((t,r)=>t.scheduled.localeCompare(r.scheduled)),Y=e.filter(t=>!t.completed&&!t.checked&&t.due&&t.start&&window.moment(t.due.toString()).isAfter(n)&&window.moment(t.start.toString()).isBefore(n)),L=e.filter(t=>!t.completed&&t.checked&&t.due&&window.moment(t.due.toString()).isSame(n)).sort((t,r)=>t.due.localeCompare(r.due)),w=e.filter(t=>!t.completed&&!t.checked&&t.dailyNote&&window.moment(t.dailyNote.toString()).isSame(n)).sort((t,r)=>t.dailyNote.localeCompare(r.dailyNote));return{allDone:u.concat(a),due:l,recurrence:v,overdue:c,start:y,scheduled:S,process:Y,cancelled:L,dailyNote:w}}function Te(e,n){var T;let a=de(s,e,"color"),l=de(s,e,"textColor"),v=de(s,e,"icon"),c=e.text.replace("'","&apos;"),y=e.link.path.replace("'","&apos;"),S=Le[n]||"",Y=e.due?window.moment(e.due).fromNow():"",L=ke(y);v?L=v+"&nbsp;"+L:(L=S+"&nbsp;"+L,n+=" noNoteIcon");let w=(T=e.header)==null?void 0:T.subpath,t=e.completed||e.checked?"checked":"",r=e.path||e.file&&e.file.path||e.link.path||"",g=r.replace(/\.md$/,""),x=typeof e.line=="number"?e.line:0,M="";a&&l?M=`--task-background:${a}33;--task-color:${a};--dark-task-text-color:${l};--light-task-text-color:${l}`:a&&!l?M=`--task-background:${a}33;--task-color:${a};--dark-task-text-color:${G(a,-40)};--light-task-text-color:${G(a,25)}`:!a&&l?M=`--task-background:#7D7D7D33;--task-color:#7D7D7D;--dark-task-text-color:${G(l,-40)};--light-task-text-color:${G(l,25)}`:M=`--task-background:#7D7D7D33;--task-color:#7D7D7D;--dark-task-text-color:${G("#7D7D7D",-40)};--light-task-text-color:${G("#7D7D7D",25)}`;let q=Ce.replace("{{taskContent}}",c).replace("{{class}}",n).replace("{{filePath}}",r).replace("{{taskPath}}",g).replace("{{taskLine}}",x).replace("{{checked}}",t).split("{{style}}").join(M).replace("{{title}}",c).replace("{{note}}",L).replace("{{icon}}",S).replace("{{relative}}",Y),k=e.due?` data-due='${e.due}'`:"";return q=q.replace("<div ",`<div data-task-text="${c.replace(/"/g,"&quot;")}"${k} `),q}function ie(e,n){let d="",{allDone:u,due:a,recurrence:l,overdue:v,start:c,scheduled:y,process:S,cancelled:Y,dailyNote:L}=te(n,e);function w(r,g){return r.priority.toUpperCase()<g.priority.toUpperCase()?-1:r.priority.toUpperCase()>g.priority.toUpperCase()?1:r.priority===g.priority?r.text.toUpperCase()<g.text.toUpperCase()?-1:r.text.toUpperCase()>g.text.toUpperCase()?1:0:0}function t(r,g){let x=[...r].sort(w);for(let M=0;M<x.length;M++)d+=Te(x[M],g)}return V===e&&t(v,"overdue"),t(a,"due"),t(l,"recurrence"),t(c,"start"),t(y,"scheduled"),t(S,"process"),t(L,"dailyNote"),t(u,"done"),t(Y,"cancelled"),d}function re(){let e=i.querySelector(".grid");e&&e.remove()}function le(e,n,d,u,a,l,v){let c=(S,Y,L,w)=>{let t=i.querySelector(`#${S}`);t&&(t.innerHTML=`${Y} <span class="stat-label">${L}</span> <span class="stat-count">${w}</span>`)};c("statisticDone","\u2705","Done",n),c("statisticDue","\u{1F4C5}","Due",e),c("statisticOverdue","\u26A0\uFE0F","Overdue",d),c("statisticStart","\u{1F6EB}","Start",u),c("statisticScheduled","\u23F3","Scheduled",a),c("statisticRecurrence","\u{1F501}","Recurring",l),c("statisticDailyNote","\u{1F4C4}","Daily",v);let y=i.querySelector("button.statistic");y&&!y.innerHTML.trim()&&(y.innerHTML="\u{1F4CA}")}function Ee(){i.querySelectorAll(".wrapperButton").forEach(e=>e.addEventListener("click",()=>{let n=e.getAttribute("data-week"),d=e.getAttribute("data-year");m=window.moment().isoWeekYear(d).isoWeek(n).startOf("isoWeek");let u=i.querySelector(`#tasksCalendar${H} .grid`);u&&u.remove(),U(D,m)}))}function be(){i.querySelectorAll(".statisticPopup li").forEach(e=>e.addEventListener("click",()=>{let n=e.getAttribute("data-group"),d=i.querySelectorAll(".statisticPopup li");if(e.classList.contains("active"))d.forEach(u=>u.classList.remove("active")),i.classList.remove("focus"+ve(n)),i.querySelectorAll(".task").forEach(u=>{u.classList.remove("highlighted")});else if(d.forEach(u=>u.classList.remove("active")),e.classList.add("active"),i.classList.remove(...Array.from(i.classList).filter(u=>u.startsWith("focus"))),i.classList.add("focus"+ve(n)),n==="overdue"){let u=window.moment().format("YYYY-MM-DD");i.querySelectorAll(".task").forEach(a=>{let l=a.getAttribute("data-due");l&&window.moment(l).isBefore(u)&&!a.classList.contains("done")&&!a.classList.contains("cancelled")&&a.classList.add("highlighted")})}}))}function Ne(){var u;let e=i.querySelector(".statisticPopup");e&&e.remove();let n="<li id='statisticDone' data-group='done'>\u2705 <span class='stat-label'>Done</span></li>";n+="<li id='statisticDue' data-group='due'>\u{1F4C5} <span class='stat-label'>Due</span></li>",n+="<li class='break'></li>",n+="<li id='statisticStart' data-group='start'>\u{1F6EB} <span class='stat-label'>Start</span></li>",n+="<li id='statisticScheduled' data-group='scheduled'>\u23F3 <span class='stat-label'>Scheduled</span></li>",n+="<li id='statisticRecurrence' data-group='recurrence'>\u{1F501} <span class='stat-label'>Recurring</span></li>",n+="<li class='break'></li>",n+="<li id='statisticDailyNote' data-group='dailyNote'>\u{1F4C4} <span class='stat-label'>Daily</span></li>";let d=document.createElement("ul");d.className="statisticPopup",d.innerHTML=n,(u=i.querySelector("span"))==null||u.appendChild(d),be()}function Pe(){i.querySelectorAll(".weekViewContext li").forEach(e=>e.addEventListener("click",()=>{var u;let n=e.getAttribute("data-style"),d=i.querySelectorAll(".weekViewContext li");e.classList.contains("active")||(d.forEach(a=>a.classList.remove("active")),e.classList.add("active"),i.classList.remove(...Array.from(i.classList).filter(a=>a.startsWith("style"))),i.classList.add(n)),(u=i.querySelector(".weekViewContext"))==null||u.classList.toggle("active")}))}function $e(){var a;let e=Array.from(i.classList).find(l=>l.startsWith("style")),n="",d=11;for(let l=1;l<d+1;l++){let v=`<div class='liIcon iconStyle${l}'><div class='box'></div><div class='box'></div><div class='box'></div><div class='box'></div><div class='box'></div><div class='box'></div><div class='box'></div></div>`;n+=`<li data-style='style${l}'>${v}Style ${l}</li>`}(a=i.querySelector("span"))==null||a.appendChild(s.el("ul",n,{cls:"weekViewContext"}));let u=i.querySelector(`.weekViewContext li[data-style='${e}']`);u&&u.classList.add("active"),Pe()}function Ae(){var u;let e=i.querySelector(".buttons");e&&e.remove();let n=document.createElement("div");n.className="buttons",[{cls:"filter",icon:ee,title:""},{cls:"listView",icon:Se,title:"List"},{cls:"monthView",icon:j,title:"Month"},{cls:"weekView",icon:De,title:"Week"},{cls:"current",icon:"",title:""},{cls:"previous",icon:ae,title:""},{cls:"next",icon:se,title:""},{cls:"overdueHighlighter",icon:"\u26A0\uFE0F",title:"Highlight overdue tasks",onClick:function(a){let l=a.classList.contains("active");if(i.querySelectorAll(".task").forEach(v=>{v.classList.remove("highlighted")}),i.querySelectorAll("button.statistic").forEach(v=>v.classList.remove("active")),l)a.classList.remove("active");else{let v=window.moment().format("YYYY-MM-DD");i.querySelectorAll(".task").forEach(c=>{let y=c.getAttribute("data-due");y&&window.moment(y).isBefore(v)&&!c.classList.contains("done")&&!c.classList.contains("cancelled")&&c.classList.add("highlighted")}),a.classList.add("active")}}},{cls:"statistic",icon:"",title:"",onClick:function(a){let l=i.querySelector(".statisticPopup"),v=a.classList.contains("active");if(i.querySelectorAll("button.overdueHighlighter").forEach(c=>c.classList.remove("active")),v)a.classList.remove("active"),l==null||l.classList.remove("active");else{a.classList.add("active"),l==null||l.classList.add("active");let c=y=>{l&&!l.contains(y.target)&&y.target!==a&&(l.classList.remove("active"),a.classList.remove("active"),document.removeEventListener("mousedown",c))};setTimeout(()=>document.addEventListener("mousedown",c),0)}}}].forEach(({cls:a,icon:l,title:v,onClick:c})=>{let y=document.createElement("button");y.className=a,l&&(y.innerHTML=l),v&&(y.title=v),a==="statistic"&&y.setAttribute("percentage",""),typeof c=="function"&&y.addEventListener("click",S=>{S.preventDefault(),c(y),y.blur()}),n.appendChild(y)}),(u=i.querySelector("span"))==null||u.appendChild(n),Ie()}function Ie(){i.querySelectorAll("button").forEach(e=>e.addEventListener("click",()=>{var d;let n=i.getAttribute("view");if(e.className==="previous")n==="month"?(m=window.moment(m).subtract(1,"months"),X(D,m)):n==="week"?(m=window.moment(m).subtract(7,"days").startOf("week"),U(D,m)):n==="list"&&(m=window.moment(m).subtract(1,"months"),J(D,m));else if(e.className==="current")n==="month"?(m=window.moment().date(1),X(D,m)):n==="week"?(m=window.moment().startOf("week"),U(D,m)):n==="list"&&(m=window.moment().date(1),J(D,m));else if(e.className==="next")n==="month"?(m=window.moment(m).add(1,"months"),X(D,m)):n==="week"?(m=window.moment(m).add(7,"days").startOf("week"),U(D,m)):n==="list"&&(m=window.moment(m).add(1,"months"),J(D,m));else if(e.className==="filter")i.classList.toggle("filter"),(d=i.querySelector("#statisticDone"))==null||d.classList.remove("active"),i.classList.remove("focusDone");else if(e.className==="monthView")m=window.moment(m).date(1),X(D,m);else if(e.className==="listView")m=window.moment(m).date(1),J(D,m);else if(e.className==="weekView")if(i.getAttribute("view")==="week"){let u=i.querySelector("button.weekView").offsetLeft;if(i.querySelector(".weekViewContext").style.left=u+"px",i.querySelector(".weekViewContext").classList.toggle("active"),i.querySelector(".weekViewContext").classList.contains("active")){let a=function(){i.querySelector(".weekViewContext").classList.remove("active"),i.removeEventListener("click",a,!1)};setTimeout(function(){i.addEventListener("click",a,!1)},100)}}else m=window.moment(m).startOf("week"),U(D,m);e.blur()})),i.addEventListener("contextmenu",function(e){e.preventDefault()})}let m;$?(m=window.moment($,"YYYY-MM").date(1),h==="week"&&(m=window.moment($,"YYYY-ww").startOf("week"))):(m=window.moment().date(1),h==="week"&&(m=window.moment().startOf("week"))),Ye(D),Ae(),Ne(),$e();function X(e,n){var q;re();let d=`<span>${window.moment(n).format("MMMM")}</span><span> ${window.moment(n).format("YYYY")}</span>`;i.querySelector("button.current").innerHTML=d;let u="",a=parseInt(window.moment(n).format("d")),l=parseInt(window.moment(n).endOf("month").format("D")),v=0,c=0,y=0,S=0,Y=0,L=0,w=0,t="";for(let k=0-a+parseInt(p);k<7-a+parseInt(p);k++){let T=window.moment(n).add(k,"days").format("d"),A=window.moment(n).add(k,"days").format("ddd");Q==T&&K==window.moment(n).format("M")&&_==window.moment(n).format("YYYY")?t+=`<div class='gridHead today' data-weekday='${T}'>${A}</div>`:t+=`<div class='gridHead' data-weekday='${T}'>${A}</div>`}let r="",g=0-a+parseInt(p);for(let k=1;k<7;k++){let T="",A="",F="",N=window.moment(n).format("MMM").replace(".","").substring(0,3);for(let E=g;E<g+7;E++){E==g&&(A=window.moment(n).add(E,"days").format("w"),F=window.moment(n).add(E,"days").format("YYYY"));let W=window.moment(n).add(E,"days").format("YYYY-MM-DD");if(window.moment(n).format("MM")===window.moment(n).add(E,"days").format("MM")){let z=te(e,W);v+=z.due.length,c+=z.allDone.length,S+=z.start.length,Y+=z.scheduled.length,L+=z.recurrence.length,w+=z.dailyNote.length}let ye=I?`${I}/${W}`:W,we=window.moment(n).add(E,"days").format("d"),qe=window.moment(n).add(E,"days").format("D"),Re=window.moment(n).add(E,"days").format("D. MMM"),ge=ie(W,e),R="";window.moment(n).add(E,"days").format("D")=="1"?R=oe.replace("{{date}}",W).replace("{{cellName}}",Re).replace("{{cellContent}}",ge).replace("{{weekday}}",we).replace("{{dailyNote}}",ye).replace("{{class}}","{{class}} newMonth"):R=oe.replace("{{date}}",W).replace("{{cellName}}",qe).replace("{{cellContent}}",ge).replace("{{weekday}}",we).replace("{{dailyNote}}",ye),E<0?R=R.replace("{{class}}","prevMonth"):E>=0&&E<l&&V!==W?R=R.replace("{{class}}","currentMonth"):E>=0&&E<l&&V==W?R=R.replace("{{class}}","currentMonth today"):E>=l&&(R=R.replace("{{class}}","nextMonth")),T+=R}r+=`<div class='wrapper'><div class='wrapperButton' data-week='${A}' data-year='${F}'>W${A}</div>${T}</div>`,g+=7}u+=`<div class='gridHeads'><div class='gridHead'></div>${t}</div>`,u+=`<div class='wrappers' data-month='${window.moment(n).format("MMM").replace(".","").substring(0,3)}'>${r}</div>`,(q=i.querySelector("span"))==null||q.appendChild(s.el("div",u,{cls:"grid"})),Ee(),le(v,c,y,S,Y,L,w),i.setAttribute("view","month"),s.app.isMobile&&setTimeout(()=>{i.querySelectorAll("[data-task-text]").forEach(k=>{var F;let T=null,A=!1;k.addEventListener("contextmenu",N=>N.preventDefault()),k.style.userSelect="none",k.style.webkitUserSelect="none",k.style.webkitUserDrag="none",k.style.touchAction="manipulation",(F=k.querySelectorAll)==null||F.call(k,"a").forEach(N=>{N.style.userSelect="none",N.style.webkitUserSelect="none",N.style.webkitUserDrag="none",N.style.touchAction="manipulation"}),k.addEventListener("touchstart",function(N){A=!1,T=setTimeout(()=>{A=!0,alert(k.getAttribute("data-task-text"))},500)}),k.addEventListener("touchend",function(N){clearTimeout(T),A&&(N.preventDefault(),N.stopPropagation())}),k.addEventListener("touchmove",function(){clearTimeout(T)}),k.addEventListener("touchcancel",function(){clearTimeout(T)}),k.onclick=null})},0);let x=window.moment().format("YYYY-MM-DD");y=e.filter(k=>!k.completed&&!k.checked&&k.due&&window.moment(k.due).isBefore(x)).length,setTimeout(()=>{i.querySelectorAll(".cell.currentMonth, .cell.currentMonth.today").forEach(k=>{k.addEventListener("click",T=>{var N,E;let A=T.target;if(A.closest(".task")||A.closest(".cellName"))return;let F=((E=(N=k.querySelector("a.cellName"))==null?void 0:N.getAttribute("href"))==null?void 0:E.split("/").pop())||"";F&&ue(s,F)})})},0)}function U(e,n){var w;re();let d=`<span>${window.moment(n).format("YYYY")}</span><span> ${window.moment(n).format("[W]w")}</span>`;i.querySelector("button.current").innerHTML=d;let u="",a=parseInt(window.moment(n).format("d")),l=0,v=0,c=0,y=0,S=0,Y=0,L=0;for(let t=0-a+parseInt(p);t<7-a+parseInt(p);t++){let r=window.moment(n).add(t,"days").format("YYYY-MM-DD"),g=te(e,r);l+=g.due.length,v+=g.allDone.length,y+=g.start.length,S+=g.scheduled.length,Y+=g.recurrence.length,L+=g.dailyNote.length;let x=I?`${I}/${r}`:r,M=window.moment(n).add(t,"days").format("d"),q=window.moment(r).format("ddd, D. MMM"),k=ie(r,e),T=oe.replace("{{date}}",r).replace("{{cellName}}",q).replace("{{cellContent}}",k).replace("{{weekday}}",M).replace("{{dailyNote}}",x);T=T.replace("{{class}}","currentWeek"),u+=T}(w=i.querySelector("span"))==null||w.appendChild(s.el("div",u,{cls:"grid"})),le(l,v,c,y,S,Y,L),i.setAttribute("view","week"),s.app.isMobile&&setTimeout(()=>{i.querySelectorAll("[data-task-text]").forEach(t=>{var x;let r=null,g=!1;t.addEventListener("contextmenu",M=>M.preventDefault()),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.webkitUserDrag="none",t.style.touchAction="manipulation",(x=t.querySelectorAll)==null||x.call(t,"a").forEach(M=>{M.style.userSelect="none",M.style.webkitUserSelect="none",M.style.webkitUserDrag="none",M.style.touchAction="manipulation"}),t.addEventListener("touchstart",function(M){g=!1,r=setTimeout(()=>{g=!0,alert(t.getAttribute("data-task-text"))},500)}),t.addEventListener("touchend",function(M){clearTimeout(r),g&&(M.preventDefault(),M.stopPropagation())}),t.addEventListener("touchmove",function(){clearTimeout(r)}),t.addEventListener("touchcancel",function(){clearTimeout(r)}),t.onclick=null})},0),setTimeout(()=>{i.querySelectorAll(".cell.currentWeek").forEach(t=>{t.addEventListener("click",r=>{var M,q;let g=r.target;if(g.closest(".task")||g.closest(".cellName"))return;let x=((q=(M=t.querySelector("a.cellName"))==null?void 0:M.getAttribute("href"))==null?void 0:q.split("/").pop())||"";x&&ue(s,x)})})},0)}function J(e,n){var L;re();let d=`<span>${window.moment(n).format("MMMM")}</span><span> ${window.moment(n).format("YYYY")}</span>`;i.querySelector("button.current").innerHTML=d;let u="",a=0,l=0,v=0,c=0,y=0,S=0,Y=0;for(let w=1;w<=31;w++){let t=window.moment(n).date(w).format("YYYY-MM-DD"),r=te(e,t);a+=r.due.length,l+=r.allDone.length,c+=r.start.length,y+=r.scheduled.length,S+=r.recurrence.length,Y+=r.dailyNote.length;let g=ie(t,e);g&&(u+=`<div class='listItem'><span class='listDate'>${t}</span><div class='listContent'>${g}</div></div>`)}(L=i.querySelector("span"))==null||L.appendChild(s.el("div",u,{cls:"grid"})),le(a,l,v,c,y,S,Y),i.setAttribute("view","list"),s.app.isMobile&&setTimeout(()=>{i.querySelectorAll("[data-task-text]").forEach(w=>{var g;let t=null,r=!1;w.addEventListener("contextmenu",x=>x.preventDefault()),w.style.userSelect="none",w.style.webkitUserSelect="none",w.style.webkitUserDrag="none",w.style.touchAction="manipulation",(g=w.querySelectorAll)==null||g.call(w,"a").forEach(x=>{x.style.userSelect="none",x.style.webkitUserSelect="none",x.style.webkitUserDrag="none",x.style.touchAction="manipulation"}),w.addEventListener("touchstart",function(x){r=!1,t=setTimeout(()=>{r=!0,alert(w.getAttribute("data-task-text"))},500)}),w.addEventListener("touchend",function(x){clearTimeout(t),r&&(x.preventDefault(),x.stopPropagation())}),w.addEventListener("touchmove",function(){clearTimeout(t)}),w.addEventListener("touchcancel",function(){clearTimeout(t)}),w.onclick=null})},0),setTimeout(()=>{i.querySelectorAll(".listDate").forEach(w=>{w.addEventListener("click",()=>{var r;let t=((r=w.textContent)==null?void 0:r.trim())||"";t&&ue(s,t)})})},0)}h==="month"?X(D,m):h==="week"?U(D,m):h==="list"&&J(D,m),setTimeout(()=>{i.querySelectorAll(".calendar-task-checkbox").forEach(e=>{e.addEventListener("change",async n=>{let d=n.target,u=d.getAttribute("data-task-path"),a=parseInt(d.getAttribute("data-task-line")||"0",10);if(!u||isNaN(a))return;let l=s.app.vault.getAbstractFileByPath(u);if(!l||!l.path||!l.stat)return;let c=(await s.app.vault.read(l)).split(`
`);if(!c[a])return;let y=window.moment().format("YYYY-MM-DD");d.checked?/✅ \d{4}-\d{2}-\d{2}$/.test(c[a])||(c[a]=c[a].replace(/\s*✅ \d{4}-\d{2}-\d{2}$/,""),c[a]+=` \u2705 ${y}`):c[a]=c[a].replace(/\s*✅ \d{4}-\d{2}-\d{2}$/,""),c[a]=c[a].replace(/^- \[[ xX]\]/,d.checked?"- [x]":"- [ ]"),await s.app.vault.modify(l,c.join(`
`))})})},0)}function G(s,o){let f=parseInt(s.replace("#",""),16),h=Math.round(2.55*o),p=(f>>16)+h,C=(f>>8&255)+h,I=(f&255)+h;return"#"+(16777216+(p<255?p<1?0:p:255)*65536+(C<255?C<1?0:C:255)*256+(I<255?I<1?0:I:255)).toString(16).slice(1)}var me=class extends P.Modal{constructor(f,h){super(f);this.taskText="";this.onSubmit=h}onOpen(){let{contentEl:f}=this;f.empty(),f.style.display="block",f.style.padding="16px 20px 12px 20px";let h=f.createEl("div");h.style.display="flex",h.style.flexDirection="row",h.style.alignItems="center",h.style.gap="10px",h.style.width="100%",h.style.maxWidth="420px",h.style.margin="0 auto";let p=h.createEl("input",{type:"text",placeholder:"Task description"});p.style.padding="8px 12px",p.style.fontSize="1.05em",p.style.border="1px solid var(--interactive-accent)",p.style.borderRadius="6px",p.style.background="var(--background-secondary)",p.style.color="var(--text-normal)",p.style.outline="none",p.style.flex="1 1 auto",p.style.minWidth="0",p.addEventListener("keydown",I=>{I.key==="Enter"&&(this.taskText=p.value,this.close(),this.onSubmit(this.taskText))}),p.focus();let C=h.createEl("button",{text:"Add"});C.style.padding="8px 16px",C.style.fontSize="1.05em",C.style.border="none",C.style.borderRadius="6px",C.style.background="var(--interactive-accent)",C.style.color="var(--text-on-accent)",C.style.cursor="pointer",C.style.transition="background 0.2s",C.style.flex="0 0 auto",C.onmouseenter=()=>C.style.background="var(--interactive-accent-hover)",C.onmouseleave=()=>C.style.background="var(--interactive-accent)",C.onclick=()=>{this.taskText=p.value,this.close(),this.onSubmit(this.taskText)}}onClose(){this.contentEl.empty()}};function ue(s,o){let f=window.calendarPluginSettings||xe,h=window.moment().format("YYYY-MM-DD");new me(s.app,async p=>{var Z,O,B,V,K,Q;if(!p||!p.trim())return;let I=`- [ ] ${f.taskPrefix?f.taskPrefix.trim():""} ${p} \u{1F4C5} ${o}`,b=null,$="";if(f.addToToday){let _=s.app.plugins.plugins["periodic-notes"],H=_==null?void 0:_.settings,D=((Z=H==null?void 0:H.daily)==null?void 0:Z.folder)||"periodic/daily",ae=((O=H==null?void 0:H.daily)==null?void 0:O.format)||"YYYY-MM-DD",se=(Q=(K=(V=(B=s.app.internalPlugins.plugins["periodic-notes"])==null?void 0:B.instance)==null?void 0:V.options)==null?void 0:K.daily)!=null&&Q.format?window.moment(h).format(s.app.internalPlugins.plugins["periodic-notes"].instance.options.daily.format):window.moment(h).format(ae);if($=`${D}/${se}.md`,b=s.app.vault.getAbstractFileByPath($),!b){await s.app.commands.executeCommandById("periodic-notes:open-daily-note"),await new Promise(j=>setTimeout(j,1500));let ee=0;for(;!b&&ee<10;)await new Promise(j=>setTimeout(j,200)),b=s.app.vault.getAbstractFileByPath($),ee++;if(!b){new P.Notice("Could not find or create the daily note.");return}}}else f.customFilePath&&($=f.customFilePath,b=s.app.vault.getAbstractFileByPath($),b||(await s.app.vault.create($,""),b=s.app.vault.getAbstractFileByPath($)));if(!b){new P.Notice("No file selected for task addition.");return}let fe=await s.app.vault.read(b);await s.app.vault.modify(b,fe+`
`+I),new P.Notice("Task added to "+b.name)}).open()}
